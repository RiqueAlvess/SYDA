{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard de Absenteísmo | Data SAAS{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}


<div class="container py-4">
    <div class="dashboard-header">
        <h1>Dashboard de Absenteísmo</h1>
        <p>Análise completa de absenteísmo corporativo</p>
    </div>

    <!-- Painel de Filtros -->
    <section class="filter-panel">
        <div class="panel-header">
            <h2>Filtros</h2>
            <button id="reset-filters" class="btn btn-secondary">Limpar Filtros</button>
        </div>
        
        <div class="filter-grid">
            <div class="filter-item">
                <label for="start-date">Data Início</label>
                <input type="date" id="start-date" class="form-input">
            </div>
            
            <div class="filter-item">
                <label for="end-date">Data Fim</label>
                <input type="date" id="end-date" class="form-input">
            </div>
            
            <div class="filter-item">
                <label for="unit-filter">Unidade</label>
                <select id="unit-filter" class="form-select">
                    <option value="">Todas as Unidades</option>
                </select>
            </div>
            
            <div class="filter-item">
                <label for="department-filter">Setor</label>
                <select id="department-filter" class="form-select">
                    <option value="">Todos os Setores</option>
                </select>
            </div>
            
            <div class="filter-item">
                <label for="situation-filter">Situação</label>
                <select id="situation-filter" class="form-select">
                    <option value="">Todas as Situações</option>
                </select>
            </div>
        </div>
        
        <div class="filter-summary">
            <p id="active-filters">Filtros aplicados: <span class="text-muted">Nenhum filtro aplicado</span></p>
            <p id="filtered-records">Exibindo 0 de 0 atestados</p>
        </div>
    </section>

    <!-- Métricas Principais -->
    <section class="metrics-grid">
        <div class="metric-card">
            <h2>Taxa de Absenteísmo</h2>
            <p id="absenteeism-rate" class="metric-value text-blue">0.00%</p>
            <p class="metric-desc">Baseado na média de horas trabalhadas no Brasil</p>
        </div>
        
        <div class="metric-card">
            <h2>Custo Total</h2>
            <p id="total-cost" class="metric-value text-green">R$ 0,00</p>
            <p class="metric-desc">Baseado no salário mínimo de R$ 1.412,00</p>
        </div>
        
        <div class="metric-card">
            <h2>Dias de Afastamento</h2>
            <p id="total-days-off" class="metric-value text-orange">0</p>
            <p class="metric-desc">Total de dias perdidos</p>
        </div>
        
        <div class="metric-card">
            <h2>Funcionários / Atestados</h2>
            <p id="employees-vs-absences" class="metric-value text-purple">0 / 0</p>
            <p class="metric-desc">Total de funcionários e atestados</p>
        </div>
    </section>

    <!-- Gráficos - Primeira Linha -->
    <div class="charts-grid">
        <section class="chart-card">
            <h2>Top 10 Unidades com Maior Absenteísmo</h2>
            <div class="chart-container">
                <canvas id="chart-units"></canvas>
            </div>
        </section>
        
        <section class="chart-card">
            <h2>Absenteísmo por Setor</h2>
            <div class="chart-container">
                <canvas id="chart-departments"></canvas>
            </div>
        </section>
    </div>

    <!-- Gráficos - Segunda Linha -->
    <div class="charts-grid">
        <section class="chart-card">
            <h2>Absenteísmo por Grupo Patológico</h2>
            <div class="chart-container">
                <canvas id="chart-cid"></canvas>
            </div>
        </section>
        
        <section class="chart-card">
            <h2>Evolução do Absenteísmo por Mês</h2>
            <div class="chart-container">
                <canvas id="chart-month"></canvas>
            </div>
        </section>
    </div>

    <!-- Gráficos - Terceira Linha -->
    <div class="charts-grid">
        <section class="chart-card">
            <h2>Absenteísmo por Gênero</h2>
            <div class="gender-grid">
                <div class="chart-container">
                    <canvas id="chart-gender"></canvas>
                </div>
                
                <div class="gender-stats">
                    <div class="stat-section">
                        <h3>Distribuição de Atestados</h3>
                        <div id="gender-distribution" class="gender-cards"></div>
                    </div>
                    
                    <div class="stat-section">
                        <h3>Dias Afastados</h3>
                        <div id="gender-days-off" class="gender-cards"></div>
                    </div>
                </div>
            </div>
            
            <div class="gender-cid-section">
                <h3>Principais Grupos Patológicos por Gênero</h3>
                <div id="gender-cid-tables" class="gender-cid-tables"></div>
            </div>
        </section>
        
        <section class="chart-card">
            <h2>Análise de Custos do Absenteísmo</h2>
            <div class="cost-analysis">
                <div class="cost-section">
                    <h3>Premissas de Cálculo</h3>
                    <div class="cost-grid">
                        <div class="cost-item">
                            <p class="cost-label">Salário Mínimo Brasil:</p>
                            <p class="cost-value">R$ 1.412,00</p>
                        </div>
                        <div class="cost-item">
                            <p class="cost-label">Horas Mensais:</p>
                            <p class="cost-value">176 horas</p>
                        </div>
                        <div class="cost-item">
                            <p class="cost-label">Valor Hora Base:</p>
                            <p id="hourly-rate" class="cost-value">R$ 8,02</p>
                        </div>
                        <div class="cost-item">
                            <p class="cost-label">Total Horas Afastadas:</p>
                            <p id="total-hours-off" class="cost-value">0 horas</p>
                        </div>
                    </div>
                </div>
                
                <div class="cost-section">
                    <h3>Custo por Setor</h3>
                    <div class="chart-container">
                        <canvas id="chart-cost-sector"></canvas>
                    </div>
                </div>
                
                <div class="cost-section">
                    <h3>Custo Total do Absenteísmo</h3>
                    <div class="total-cost-box">
                        <p id="total-cost-value" class="total-cost-value">R$ 0,00</p>
                        <p id="total-cost-percent" class="cost-percent">Representa 0% da folha salarial estimada</p>
                    </div>
                </div>
                
                <div class="cost-section">
                    <h3>Projeção de Economia</h3>
                    <div class="savings-grid">
                        <div class="savings-card">
                            <h4>Economia com redução de 10%</h4>
                            <p id="savings-10" class="savings-value">R$ 0,00</p>
                        </div>
                        <div class="savings-card">
                            <h4>Economia com redução de 20%</h4>
                            <p id="savings-20" class="savings-value">R$ 0,00</p>
                        </div>
                        <div class="savings-card">
                            <h4>Economia com redução de 30%</h4>
                            <p id="savings-30" class="savings-value">R$ 0,00</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Carregando dados...</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}